{"ast":null,"code":"import _objectSpread from\"C:/Users/shiva/Desktop/talentflow-mini-hiring-platform/TalentFlow/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{useAuth}from'../store';import{apiCall}from'../utils/apiUtils';import Button from'../components/ui/Button';import Card from'../components/ui/Card';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TakeAssessment=()=>{const{jobId}=useParams();const navigate=useNavigate();const{user}=useAuth();const[assessment,setAssessment]=useState(null);const[responses,setResponses]=useState({});const[currentSection,setCurrentSection]=useState(0);const[loading,setLoading]=useState(true);const[submitting,setSubmitting]=useState(false);const[invitationStatus,setInvitationStatus]=useState(null);const[candidateId,setCandidateId]=useState('');useEffect(()=>{if(jobId){checkInvitationAndLoadAssessment();}},[jobId]);const checkInvitationAndLoadAssessment=async()=>{try{setLoading(true);// First, get the candidate ID\nconst candidatesResponse=await apiCall(\"/api/candidates?search=\".concat(encodeURIComponent(user.email),\"&page=1&pageSize=100\"));if(!candidatesResponse.ok){toast.error('Unable to verify your application status');navigate('/jobs');return;}const candidatesData=await candidatesResponse.json();const applications=candidatesData.data||[];const currentApplication=applications.find(app=>app.jobId===jobId);if(!currentApplication){toast.error('You must apply for this job before taking the assessment');navigate('/jobs');return;}setCandidateId(currentApplication.id);// Check invitation status\nconst statusResponse=await apiCall(\"/api/candidates/\".concat(currentApplication.id,\"/assessment-status/\").concat(jobId));if(!statusResponse.ok){toast.error('Unable to check assessment status');navigate('/jobs');return;}const status=await statusResponse.json();setInvitationStatus(status);// If not invited or already completed, don't load assessment\nif(!status.invited){return;}if(status.completed){return;}// Load assessment if invited and not completed\nconst assessmentResponse=await apiCall(\"/api/assessments/\".concat(jobId));if(!assessmentResponse.ok){toast.error('Assessment not found');navigate('/jobs');return;}const assessmentData=await assessmentResponse.json();setAssessment(assessmentData.data);}catch(error){console.error('Error loading assessment:',error);toast.error('Failed to load assessment');navigate('/jobs');}finally{setLoading(false);}};const handleResponse=(questionId,value)=>{setResponses(prev=>_objectSpread(_objectSpread({},prev),{},{[questionId]:value}));};const isQuestionVisible=question=>{if(!question.conditional)return true;const dependentResponse=responses[question.conditional.dependsOn];return dependentResponse===question.conditional.value;};const validateSection=sectionIndex=>{if(!assessment)return false;const section=assessment.sections[sectionIndex];const visibleQuestions=section.questions.filter(isQuestionVisible);for(const question of visibleQuestions){var _question$validation3;if(question.required&&!responses[question.id]){return false;}// Validate numeric ranges\nif(question.type==='numeric'&&responses[question.id]!==undefined){var _question$validation,_question$validation2;const value=Number(responses[question.id]);if(((_question$validation=question.validation)===null||_question$validation===void 0?void 0:_question$validation.min)!==undefined&&value<question.validation.min){return false;}if(((_question$validation2=question.validation)===null||_question$validation2===void 0?void 0:_question$validation2.max)!==undefined&&value>question.validation.max){return false;}}// Validate text length\nif((_question$validation3=question.validation)!==null&&_question$validation3!==void 0&&_question$validation3.maxLength&&responses[question.id]){if(responses[question.id].length>question.validation.maxLength){return false;}}}return true;};const handleNext=()=>{if(!validateSection(currentSection)){toast.error('Please complete all required fields');return;}if(assessment&&currentSection<assessment.sections.length-1){setCurrentSection(currentSection+1);}};const handlePrevious=()=>{if(currentSection>0){setCurrentSection(currentSection-1);}};const handleSubmit=async()=>{if(!assessment||!validateSection(currentSection)){toast.error('Please complete all required fields');return;}try{setSubmitting(true);const response=await apiCall(\"/api/assessments/\".concat(jobId,\"/submit\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({candidateId,responses})});if(!response.ok)throw new Error('Failed to submit assessment');toast.success('Assessment submitted successfully!');navigate('/my-applications');}catch(error){toast.error('Failed to submit assessment');}finally{setSubmitting(false);}};const renderQuestion=question=>{var _question$options,_question$options2,_question$validation4,_question$validation5,_question$validation6,_question$validation7;if(!isQuestionVisible(question))return null;const value=responses[question.id]||'';return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium text-gray-900 dark:text-white mb-2\",children:[question.title,question.required&&/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 ml-1\",children:\"*\"})]}),question.description&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mb-3\",children:question.description}),question.type==='single-choice'&&/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:(_question$options=question.options)===null||_question$options===void 0?void 0:_question$options.map(option=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:question.id,value:option,checked:value===option,onChange:e=>handleResponse(question.id,e.target.value),className:\"mr-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-900 dark:text-white\",children:option})]},option))}),question.type==='multi-choice'&&/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:(_question$options2=question.options)===null||_question$options2===void 0?void 0:_question$options2.map(option=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:Array.isArray(value)&&value.includes(option),onChange:e=>{const currentValues=Array.isArray(value)?value:[];if(e.target.checked){handleResponse(question.id,[...currentValues,option]);}else{handleResponse(question.id,currentValues.filter(v=>v!==option));}},className:\"mr-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-900 dark:text-white\",children:option})]},option))}),question.type==='short-text'&&/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:value,onChange:e=>handleResponse(question.id,e.target.value),className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\",maxLength:(_question$validation4=question.validation)===null||_question$validation4===void 0?void 0:_question$validation4.maxLength}),question.type==='long-text'&&/*#__PURE__*/_jsx(\"textarea\",{value:value,onChange:e=>handleResponse(question.id,e.target.value),rows:4,className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\",maxLength:(_question$validation5=question.validation)===null||_question$validation5===void 0?void 0:_question$validation5.maxLength}),question.type==='numeric'&&/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:value,onChange:e=>handleResponse(question.id,e.target.value),min:(_question$validation6=question.validation)===null||_question$validation6===void 0?void 0:_question$validation6.min,max:(_question$validation7=question.validation)===null||_question$validation7===void 0?void 0:_question$validation7.max,className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"}),question.type==='file-upload'&&/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:e=>{var _e$target$files,_e$target$files$;return handleResponse(question.id,((_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:(_e$target$files$=_e$target$files[0])===null||_e$target$files$===void 0?void 0:_e$target$files$.name)||'');},className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"})]},question.id);};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"Loading assessment...\"})]})});}// Show different messages based on invitation status\nif(!loading&&invitationStatus){if(!invitationStatus.hasAssessment){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white mb-4\",children:\"No Assessment Available\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mb-6\",children:\"There is no assessment created for this job yet.\"}),/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/jobs'),children:\"Back to Jobs\"})]})});}if(!invitationStatus.invited){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-6xl mb-6\",children:\"\\u23F3\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white mb-4\",children:\"Assessment Invitation Pending\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mb-6\",children:\"You haven't been invited to take this assessment yet. HR will send you an invitation when you reach the appropriate stage in the hiring process.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/my-applications'),children:\"View My Applications\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>navigate('/jobs'),children:\"Back to Jobs\"})]})]})});}if(invitationStatus.completed){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-6xl mb-6\",children:\"\\u2705\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white mb-4\",children:\"Assessment Already Completed\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mb-6\",children:\"You have already completed this assessment. Thank you for your submission!\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/my-applications'),children:\"View My Applications\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>navigate('/jobs'),children:\"Back to Jobs\"})]})]})});}}if(!assessment){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white mb-4\",children:\"Assessment Not Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mb-6\",children:\"The assessment for this job is not available.\"}),/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/jobs'),children:\"Back to Jobs\"})]})});}const currentSectionData=assessment.sections[currentSection];const isLastSection=currentSection===assessment.sections.length-1;return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 dark:bg-gray-900\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",children:/*#__PURE__*/_jsxs(Card,{className:\"p-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 dark:text-white mb-2\",children:assessment.title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mb-4\",children:assessment.description}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-600 h-2 rounded-full transition-all duration-300\",style:{width:\"\".concat((currentSection+1)/assessment.sections.length*100,\"%\")}})}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mt-2\",children:[\"Section \",currentSection+1,\" of \",assessment.sections.length]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold text-gray-900 dark:text-white mb-6\",children:currentSectionData.title}),currentSectionData.questions.map(renderQuestion)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handlePrevious,disabled:currentSection===0,children:\"Previous\"}),isLastSection?/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleSubmit,loading:submitting,children:\"Submit Assessment\"}):/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleNext,children:\"Next Section\"})]})]})})});};export default TakeAssessment;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}