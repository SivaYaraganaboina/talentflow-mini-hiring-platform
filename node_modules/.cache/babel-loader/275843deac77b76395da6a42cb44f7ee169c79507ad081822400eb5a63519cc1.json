{"ast":null,"code":"import React,{useState,useEffect}from'react';import{motion}from'framer-motion';import{UserIcon,ClockIcon,EyeIcon,CalendarIcon,StarIcon,DocumentTextIcon,ChartBarIcon}from'@heroicons/react/24/outline';import{apiCall}from'../utils/apiUtils';import Card from'./ui/Card';import Button from'./ui/Button';import Modal from'./ui/Modal';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const AssessmentSubmissions=_ref=>{let{jobId,jobTitle}=_ref;const[submissions,setSubmissions]=useState([]);const[loading,setLoading]=useState(true);const[selectedSubmission,setSelectedSubmission]=useState(null);const[showModal,setShowModal]=useState(false);const[assessment,setAssessment]=useState(null);const[questionsWithAnswers,setQuestionsWithAnswers]=useState([]);useEffect(()=>{loadData();},[jobId]);const loadData=async()=>{try{setLoading(true);// Load assessment details\nconst assessmentResponse=await apiCall(\"/api/assessments/\".concat(jobId));if(assessmentResponse.ok){const assessmentData=await assessmentResponse.json();setAssessment(assessmentData.data);}// Load submissions\nconst response=await apiCall(\"/api/assessments/\".concat(jobId,\"/submissions\"));if(response.ok){const data=await response.json();setSubmissions(data.data||[]);}}catch(error){console.error('Error loading data:',error);toast.error('Failed to load assessment data');}finally{setLoading(false);}};const calculateScore=(submission,assessment)=>{if(!(assessment!==null&&assessment!==void 0&&assessment.sections)||!submission.responses){return{score:0,details:[]};}// If submission already has a calculated score, use it\nif(submission.score!==undefined){const details=getQuestionDetails(submission,assessment);return{score:submission.score,details};}// Fallback calculation for older submissions\nlet totalScore=0;let totalPossibleScore=0;const details=[];assessment.sections.forEach(section=>{var _section$questions;(_section$questions=section.questions)===null||_section$questions===void 0?void 0:_section$questions.forEach(question=>{const userAnswer=submission.responses[question.id];const questionPoints=question.points||1;let isCorrect=false;let earnedPoints=0;if(question.correctAnswer!==undefined&&userAnswer!==undefined){totalPossibleScore+=questionPoints;if(question.type==='single-choice'){isCorrect=userAnswer===question.correctAnswer;earnedPoints=isCorrect?questionPoints:0;}else if(question.type==='multi-choice'){const correctAnswers=Array.isArray(question.correctAnswer)?question.correctAnswer:[];const userAnswers=Array.isArray(userAnswer)?userAnswer:[];if(correctAnswers.length>0){const correctSelected=userAnswers.filter(answer=>correctAnswers.includes(answer)).length;const incorrectSelected=userAnswers.filter(answer=>!correctAnswers.includes(answer)).length;const partialScore=Math.max(0,(correctSelected-incorrectSelected)/correctAnswers.length);earnedPoints=questionPoints*partialScore;isCorrect=partialScore===1;}}totalScore+=earnedPoints;}details.push({id:question.id,question:question.title||question.description||'Question',type:question.type,options:question.options,correctAnswer:question.correctAnswer,userAnswer:userAnswer||'No answer provided',isCorrect,score:earnedPoints});});});const finalScore=totalPossibleScore>0?Math.round(totalScore/totalPossibleScore*100):0;return{score:finalScore,details};};const getQuestionDetails=(submission,assessment)=>{const details=[];assessment.sections.forEach(section=>{var _section$questions2;(_section$questions2=section.questions)===null||_section$questions2===void 0?void 0:_section$questions2.forEach(question=>{const userAnswer=submission.responses[question.id];let isCorrect=false;if(question.correctAnswer!==undefined&&userAnswer!==undefined){if(question.type==='single-choice'){isCorrect=userAnswer===question.correctAnswer;}else if(question.type==='multi-choice'){const correctAnswers=Array.isArray(question.correctAnswer)?question.correctAnswer:[];const userAnswers=Array.isArray(userAnswer)?userAnswer:[];isCorrect=correctAnswers.length>0&&correctAnswers.every(answer=>userAnswers.includes(answer))&&userAnswers.every(answer=>correctAnswers.includes(answer));}}details.push({id:question.id,question:question.title||question.description||'Question',type:question.type,options:question.options,correctAnswer:question.correctAnswer,userAnswer:userAnswer||'No answer provided',isCorrect,score:isCorrect?question.points||1:0});});});return details;};const handleViewSubmission=submission=>{if(!assessment)return;const{details}=calculateScore(submission,assessment);setQuestionsWithAnswers(details);setSelectedSubmission(submission);setShowModal(true);};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 border border-blue-200 dark:border-blue-800\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center\",children:/*#__PURE__*/_jsx(DocumentTextIcon,{className:\"w-6 h-6 text-white\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-900 dark:text-white\",children:\"Assessment Submissions\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-blue-600 dark:text-blue-400 font-medium\",children:jobTitle})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-blue-600 dark:text-blue-400\",children:submissions.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Total Submissions\"})]})]}),submissions.length>0&&assessment&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(ChartBarIcon,{className:\"w-5 h-5 text-green-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"Avg Score\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-green-600\",children:[assessment.enableScoring?Math.round(submissions.reduce((acc,sub)=>acc+calculateScore(sub,assessment).score,0)/submissions.length):'N/A',\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(StarIcon,{className:\"w-5 h-5 text-yellow-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"Top Score\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-yellow-600\",children:[assessment.enableScoring?Math.max(...submissions.map(sub=>calculateScore(sub,assessment).score)):'N/A',\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(ClockIcon,{className:\"w-5 h-5 text-blue-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"Latest\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-bold text-blue-600\",children:new Date(Math.max(...submissions.map(sub=>new Date(sub.submittedAt).getTime()))).toLocaleDateString()})]})]})]}),submissions.length===0?/*#__PURE__*/_jsxs(Card,{className:\"p-12 text-center\",children:[/*#__PURE__*/_jsx(UserIcon,{className:\"w-16 h-16 text-gray-400 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-xl font-semibold text-gray-900 dark:text-white mb-2\",children:\"No Submissions Yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"No candidates have completed the assessment for this job.\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white flex items-center\",children:[/*#__PURE__*/_jsx(UserIcon,{className:\"w-5 h-5 mr-2\"}),\"Candidate Submissions\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:submissions.sort((a,b)=>{if(!assessment||!assessment.enableScoring)return 0;const scoreA=calculateScore(a,assessment).score;const scoreB=calculateScore(b,assessment).score;return scoreB-scoreA;}).map((submission,index)=>{const{score}=assessment?calculateScore(submission,assessment):{score:0};const scoreColor=score>=80?'text-green-600':score>=60?'text-yellow-600':'text-red-600';const scoreBg=score>=80?'bg-green-100 dark:bg-green-900/20':score>=60?'bg-yellow-100 dark:bg-yellow-900/20':'bg-red-100 dark:bg-red-900/20';return/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:index*0.1},children:/*#__PURE__*/_jsx(Card,{className:\"p-6 hover:shadow-lg transition-all duration-200 border-l-4 border-l-blue-500\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(UserIcon,{className:\"w-6 h-6 text-white\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs font-bold text-white\",children:[\"#\",index+1]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3 mb-2\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:[\"Candidate #\",submission.candidateId.slice(-4)]}),assessment!==null&&assessment!==void 0&&assessment.enableScoring?/*#__PURE__*/_jsxs(\"div\",{className:\"px-3 py-1 rounded-full text-sm font-bold \".concat(scoreBg,\" \").concat(scoreColor),children:[\"Score: \",score,\"%\"]}):/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-1 rounded-full text-sm font-bold bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400\",children:\"Manual Review\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-6 text-sm text-gray-600 dark:text-gray-300\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"w-4 h-4 mr-1\"}),new Date(submission.submittedAt).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(ClockIcon,{className:\"w-4 h-4 mr-1\"}),new Date(submission.submittedAt).toLocaleTimeString()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(DocumentTextIcon,{className:\"w-4 h-4 mr-1\"}),Object.keys(submission.responses||{}).length,\" responses\"]})]})]})]}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",size:\"md\",onClick:()=>handleViewSubmission(submission),icon:/*#__PURE__*/_jsx(EyeIcon,{className:\"w-4 h-4\"}),className:\"ml-4\",children:\"View Details\"})]})})},submission.id);})})]}),/*#__PURE__*/_jsx(Modal,{isOpen:showModal,onClose:()=>setShowModal(false),title:\"Assessment Submission Details\",size:\"xl\",children:selectedSubmission&&assessment&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 border border-blue-200 dark:border-blue-800\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(UserIcon,{className:\"w-8 h-8 text-white\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-2xl font-bold text-gray-900 dark:text-white mb-1\",children:[\"Candidate #\",selectedSubmission.candidateId.slice(-4)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-300\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"w-4 h-4 mr-1\"}),new Date(selectedSubmission.submittedAt).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(ClockIcon,{className:\"w-4 h-4 mr-1\"}),new Date(selectedSubmission.submittedAt).toLocaleTimeString()]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\",children:assessment.enableScoring?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-4xl font-bold text-blue-600 dark:text-blue-400 mb-1\",children:[calculateScore(selectedSubmission,assessment).score,\"%\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Overall Score\"}),selectedSubmission.scoredQuestions&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500 dark:text-gray-400 mt-1\",children:[selectedSubmission.scoredQuestions,\" questions scored\"]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-gray-600 dark:text-gray-400 mb-1\",children:\"Manual Review\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Scoring Disabled\"})]})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"text-xl font-bold text-gray-900 dark:text-white flex items-center\",children:[/*#__PURE__*/_jsx(DocumentTextIcon,{className:\"w-6 h-6 mr-2\"}),\"Detailed Responses\"]}),questionsWithAnswers.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4 max-h-96 overflow-y-auto\",children:questionsWithAnswers.map((qa,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-xl p-4 \".concat(!assessment.enableScoring||qa.correctAnswer===undefined?'border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800':qa.isCorrect?'border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20':'border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-gray-500 dark:text-gray-400\",children:[\"Question \",index+1]}),assessment.enableScoring&&qa.correctAnswer!==undefined?/*#__PURE__*/_jsxs(\"div\",{className:\"px-2 py-1 rounded-full text-xs font-bold \".concat(qa.isCorrect?'bg-green-200 text-green-800 dark:bg-green-800 dark:text-green-200':'bg-red-200 text-red-800 dark:bg-red-800 dark:text-red-200'),children:[qa.isCorrect?'Correct':'Incorrect',\" (\",qa.score,\" pts)\"]}):/*#__PURE__*/_jsx(\"div\",{className:\"px-2 py-1 rounded-full text-xs font-bold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-200\",children:\"Manual Review\"})]}),/*#__PURE__*/_jsx(\"h6\",{className:\"font-semibold text-gray-900 dark:text-white mb-3\",children:qa.question})]}),assessment.enableScoring&&qa.correctAnswer!==undefined?/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 rounded-full flex items-center justify-center \".concat(qa.isCorrect?'bg-green-500 text-white':'bg-red-500 text-white'),children:qa.isCorrect?'✓':'✗'}):/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 rounded-full flex items-center justify-center bg-gray-400 text-white\",children:\"?\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Candidate's Answer:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-900 dark:text-white bg-white dark:bg-gray-800 p-2 rounded border\",children:Array.isArray(qa.userAnswer)?qa.userAnswer.join(', '):String(qa.userAnswer)})]}),assessment.enableScoring&&qa.correctAnswer!==undefined?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Correct Answer:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-900 dark:text-white bg-white dark:bg-gray-800 p-2 rounded border\",children:Array.isArray(qa.correctAnswer)?qa.correctAnswer.join(', '):String(qa.correctAnswer)})]}):qa.type==='short-text'||qa.type==='long-text'?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Expected Answer (Reference):\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800 p-2 rounded border italic\",children:qa.correctAnswer||'No reference answer provided'})]}):null]})]},qa.id))}):/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 dark:text-gray-400 text-center py-8\",children:\"No responses recorded for this submission.\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border-t border-gray-200 dark:border-gray-700 pt-4\",children:assessment.enableScoring?/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-4 gap-4 text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-600\",children:questionsWithAnswers.filter(qa=>qa.isCorrect&&qa.correctAnswer!==undefined).length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Correct\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-red-600\",children:questionsWithAnswers.filter(qa=>!qa.isCorrect&&qa.correctAnswer!==undefined).length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Incorrect\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-gray-600\",children:questionsWithAnswers.filter(qa=>qa.correctAnswer===undefined).length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Manual Review\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:questionsWithAnswers.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Total\"})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:questionsWithAnswers.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Total Questions (Manual Review Required)\"})]})})]})})]});};export default AssessmentSubmissions;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}