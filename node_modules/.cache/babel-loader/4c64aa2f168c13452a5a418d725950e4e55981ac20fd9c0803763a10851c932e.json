{"ast":null,"code":"import _objectSpread from\"C:/Users/shiva/Desktop/talentflow-mini-hiring-platform/TalentFlow/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useSearchParams}from'react-router-dom';import{MagnifyingGlassIcon,BriefcaseIcon,XMarkIcon,EnvelopeIcon,PhoneIcon,CalendarIcon,DocumentTextIcon}from'@heroicons/react/24/outline';import{apiCall}from'../utils/apiUtils';import{useAuth}from'../store';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const stages=['applied','screen','tech','offer','hired','rejected'];const CandidateKanbanSimple=()=>{var _jobs$find,_selectedCandidate$ti;const[searchParams]=useSearchParams();const urlJobId=searchParams.get('jobId');const[candidates,setCandidates]=useState([]);const[jobs,setJobs]=useState([]);const[loading,setLoading]=useState(true);const[draggedCandidate,setDraggedCandidate]=useState(null);const[selectedJobId,setSelectedJobId]=useState(urlJobId||'');const[searchTerm,setSearchTerm]=useState('');const[selectedCandidate,setSelectedCandidate]=useState(null);const[candidateApplications,setCandidateApplications]=useState([]);const[modalLoading,setModalLoading]=useState(false);const{user}=useAuth();useEffect(()=>{loadData();},[]);useEffect(()=>{loadCandidates();},[selectedJobId]);const loadData=async()=>{try{setLoading(true);// Load jobs\nconst jobsResponse=await apiCall('/api/jobs?status=active&page=1&pageSize=100');if(jobsResponse.ok){var _jobsData$data;const jobsData=await jobsResponse.json();setJobs(jobsData.data||[]);if(!urlJobId&&((_jobsData$data=jobsData.data)===null||_jobsData$data===void 0?void 0:_jobsData$data.length)>0){setSelectedJobId(jobsData.data[0].id);}}}catch(error){console.error('Error loading data:',error);toast.error('Failed to load data');}finally{setLoading(false);}};const loadCandidates=async()=>{if(!selectedJobId)return;try{const url=\"/api/candidates?jobId=\".concat(selectedJobId,\"&page=1&pageSize=1000\");const response=await apiCall(url);if(response.ok){const data=await response.json();setCandidates(data.data||[]);}}catch(error){console.error('Error loading candidates:',error);toast.error('Failed to load candidates');}};const getCandidatesByStage=stage=>{return candidates.filter(candidate=>{const matchesStage=candidate.stage===stage;const matchesSearch=searchTerm===''||candidate.name.toLowerCase().includes(searchTerm.toLowerCase())||candidate.email.toLowerCase().includes(searchTerm.toLowerCase());return matchesStage&&matchesSearch;});};const getStageBadge=stage=>{const badgeClasses={applied:'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',screen:'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',tech:'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',offer:'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',hired:'bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200',rejected:'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'};return/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 text-xs font-medium rounded-full \".concat(badgeClasses[stage]||badgeClasses.applied),children:stage});};const handleDragStart=(e,candidate)=>{setDraggedCandidate(candidate);e.dataTransfer.effectAllowed='move';};const handleDragOver=e=>{e.preventDefault();e.dataTransfer.dropEffect='move';};const handleDrop=async(e,targetStage)=>{e.preventDefault();if(!draggedCandidate||draggedCandidate.stage===targetStage){setDraggedCandidate(null);return;}const oldStage=draggedCandidate.stage;// Optimistic update\nconst updatedCandidates=candidates.map(c=>c.id===draggedCandidate.id?_objectSpread(_objectSpread({},c),{},{stage:targetStage}):c);setCandidates(updatedCandidates);try{const response=await apiCall(\"/api/candidates/\".concat(draggedCandidate.id),{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({stage:targetStage,notes:\"Moved from \".concat(oldStage,\" to \").concat(targetStage,\" by \").concat(user.name)})});if(response.ok){toast.success(\"Candidate moved to \".concat(targetStage,\" stage\"));loadCandidates();}else{throw new Error('Failed to update candidate stage');}}catch(error){console.error('Error updating candidate stage:',error);setCandidates(candidates);toast.error('Failed to update candidate stage');}finally{setDraggedCandidate(null);}};const handleInviteToAssessment=async candidate=>{try{// Check if assessment exists for this job\nconst assessmentResponse=await apiCall(\"/api/assessments/\".concat(selectedJobId));const assessmentData=await assessmentResponse.json();const hasExistingAssessment=assessmentData.data;if(hasExistingAssessment){// Show modal to choose between existing or new assessment\nconst choice=window.confirm(\"An assessment already exists for this job.\\n\\nClick OK to use the existing assessment\\nClick Cancel to create a new assessment\");if(choice){// Use existing assessment - send invitation\nawait sendAssessmentInvitation(candidate);}else{// Create new assessment - redirect to assessment builder\nwindow.location.href=\"/assessments?jobId=\".concat(selectedJobId,\"&candidateId=\").concat(candidate.id);return;}}else{// No existing assessment - redirect to create new one\nconst shouldCreate=window.confirm(\"No assessment exists for this job yet.\\n\\nWould you like to create an assessment now?\");if(shouldCreate){window.location.href=\"/assessments?jobId=\".concat(selectedJobId,\"&candidateId=\").concat(candidate.id);return;}}}catch(error){console.error('Error checking assessment:',error);toast.error('Failed to process assessment invitation');}};const sendAssessmentInvitation=async candidate=>{try{const response=await apiCall(\"/api/candidates/\".concat(candidate.id,\"/invite-assessment\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jobId:selectedJobId,invitedBy:user.name,stage:candidate.stage})});if(response.ok){toast.success(\"Assessment invitation sent to \".concat(candidate.name));}else{throw new Error('Failed to send invitation');}}catch(error){console.error('Error sending invitation:',error);toast.error('Failed to send assessment invitation');}};const openCandidateModal=async candidate=>{setSelectedCandidate(candidate);setModalLoading(true);try{const applicationsResponse=await apiCall(\"/api/candidates?search=\".concat(encodeURIComponent(candidate.email),\"&page=1&pageSize=100\"));if(applicationsResponse.ok){const applicationsData=await applicationsResponse.json();setCandidateApplications(applicationsData.data||[]);}}catch(error){console.error('Error loading candidate details:',error);}finally{setModalLoading(false);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"Loading candidates...\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white\",children:\"Candidate Pipeline\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mt-1\",children:\"Drag candidates between stages to update their status\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Filter by Job\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(BriefcaseIcon,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedJobId,onChange:e=>setSelectedJobId(e.target.value),className:\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Jobs\"}),jobs.map(job=>/*#__PURE__*/_jsx(\"option\",{value:job.id,children:job.title},job.id))]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Search Candidates\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(MagnifyingGlassIcon,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by name or email...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"})]})]})]}),selectedJobId&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-blue-800 dark:text-blue-200\",children:[\"Showing candidates for: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:(_jobs$find=jobs.find(j=>j.id===selectedJobId))===null||_jobs$find===void 0?void 0:_jobs$find.title})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-6 overflow-x-auto pb-4\",children:stages.map(stage=>/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 w-80\",onDragOver:handleDragOver,onDrop:e=>handleDrop(e,stage),children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 h-full min-h-[400px]\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white capitalize\",children:stage.charAt(0).toUpperCase()+stage.slice(1)}),/*#__PURE__*/_jsx(\"span\",{className:\"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full text-sm font-medium\",children:getCandidatesByStage(stage).length})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:getCandidatesByStage(stage).map(candidate=>/*#__PURE__*/_jsxs(\"div\",{draggable:true,onDragStart:e=>handleDragStart(e,candidate),onClick:()=>openCandidateModal(candidate),className:\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600 cursor-pointer transition-all \".concat((draggedCandidate===null||draggedCandidate===void 0?void 0:draggedCandidate.id)===candidate.id?'opacity-50 scale-95':'hover:shadow-md hover:border-blue-300'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between mb-3\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-900 dark:text-white\",children:candidate.name}),getStageBadge(candidate.stage)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-sm text-gray-600 dark:text-gray-400\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mr-2\",children:\"\\uD83D\\uDCE7\"}),/*#__PURE__*/_jsx(\"span\",{className:\"truncate\",children:candidate.email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mr-2\",children:\"\\uD83D\\uDCDE\"}),/*#__PURE__*/_jsx(\"span\",{children:candidate.phone})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mr-2\",children:\"\\uD83D\\uDCC5\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Applied: \",new Date(candidate.appliedAt).toLocaleDateString()]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"a\",{href:\"/candidates/\".concat(candidate.id),className:\"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors\",children:\"View Profile \\u2192\"}),(stage==='screen'||stage==='tech')&&/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();handleInviteToAssessment(candidate);},className:\"inline-flex items-center px-2 py-1 text-xs font-medium text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 bg-green-50 dark:bg-green-900/20 rounded transition-colors\",children:\"\\uD83D\\uDCDD Invite Assessment\"})]})]},candidate.id))})]})},stage))}),selectedCandidate&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-xl\",children:selectedCandidate.name.charAt(0).toUpperCase()}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white\",children:selectedCandidate.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"Candidate Profile\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedCandidate(null),className:\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\",children:/*#__PURE__*/_jsx(XMarkIcon,{className:\"w-6 h-6\"})})]}),modalLoading?/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin\"})}):/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:\"Contact Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(EnvelopeIcon,{className:\"w-5 h-5 text-gray-400 mr-3\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-700 dark:text-gray-300\",children:selectedCandidate.email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(PhoneIcon,{className:\"w-5 h-5 text-gray-400 mr-3\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-700 dark:text-gray-300\",children:selectedCandidate.phone})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"w-5 h-5 text-gray-400 mr-3\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-700 dark:text-gray-300\",children:[\"Applied \",new Date(selectedCandidate.appliedAt).toLocaleDateString()]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:\"Current Status & Actions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Current Stage:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"inline-block ml-2 px-3 py-1 text-sm font-medium rounded-full \".concat(selectedCandidate.stage==='applied'?'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200':selectedCandidate.stage==='screen'?'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200':selectedCandidate.stage==='tech'?'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200':selectedCandidate.stage==='offer'?'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200':selectedCandidate.stage==='hired'?'bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200':'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'),children:selectedCandidate.stage})]}),(selectedCandidate.stage==='screen'||selectedCandidate.stage==='tech')&&/*#__PURE__*/_jsx(\"div\",{className:\"pt-2\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleInviteToAssessment(selectedCandidate),className:\"inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors\",children:[/*#__PURE__*/_jsx(DocumentTextIcon,{className:\"w-4 h-4 mr-2\"}),\"Send Assessment Invitation\"]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:\"All Applications\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3 max-h-60 overflow-y-auto\",children:candidateApplications.map(app=>{const job=jobs.find(j=>j.id===app.jobId);return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900 dark:text-white\",children:(job===null||job===void 0?void 0:job.title)||'Unknown Job'}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[\"Applied \",new Date(app.appliedAt).toLocaleDateString()]})]}),/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 text-xs font-medium rounded-full \".concat(app.stage==='applied'?'bg-blue-100 text-blue-800':app.stage==='screen'?'bg-yellow-100 text-yellow-800':app.stage==='tech'?'bg-purple-100 text-purple-800':app.stage==='offer'?'bg-green-100 text-green-800':app.stage==='hired'?'bg-emerald-100 text-emerald-800':'bg-red-100 text-red-800'),children:app.stage})]},app.id);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:\"Application Timeline\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4 max-h-60 overflow-y-auto\",children:(_selectedCandidate$ti=selectedCandidate.timeline)===null||_selectedCandidate$ti===void 0?void 0:_selectedCandidate$ti.map((entry,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-xs font-medium text-blue-600 dark:text-blue-400\",children:index+1})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900 dark:text-white capitalize\",children:entry.stage}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500 dark:text-gray-400\",children:new Date(entry.timestamp).toLocaleDateString()})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:entry.notes})]})]},entry.id))})]})]})]})})})]});};export default CandidateKanbanSimple;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}