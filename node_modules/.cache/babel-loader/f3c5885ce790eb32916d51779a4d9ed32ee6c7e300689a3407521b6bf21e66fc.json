{"ast":null,"code":"import React,{useState,useEffect}from'react';import{motion}from'framer-motion';import{PlusIcon,DocumentTextIcon,EyeIcon,PencilIcon,TrashIcon,ClockIcon,CheckCircleIcon,ArrowLeftIcon}from'@heroicons/react/24/outline';import{apiCall}from'../utils/apiUtils';import AssessmentSubmissions from'./AssessmentSubmissions';import{reseedDatabase}from'../services/database';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AssessmentListProfessional=_ref=>{var _jobs$find2,_jobs$find3;let{onCreateAssessment}=_ref;const[jobs,setJobs]=useState([]);const[assessments,setAssessments]=useState([]);const[loading,setLoading]=useState(true);const[selectedAssessment,setSelectedAssessment]=useState(null);useEffect(()=>{loadData();},[]);const loadData=async()=>{try{setLoading(true);// Load jobs\nconst jobsResponse=await apiCall('/api/jobs?page=1&pageSize=100');if(jobsResponse.ok){const jobsData=await jobsResponse.json();const loadedJobs=jobsData.data||[];setJobs(loadedJobs);// Load assessments for each job\nconst assessmentPromises=loadedJobs.map(async job=>{try{const response=await apiCall(\"/api/assessments/\".concat(job.id));if(response.ok){const data=await response.json();return data.data;}return null;}catch(_unused){return null;}});const assessmentResults=await Promise.all(assessmentPromises);const validAssessments=assessmentResults.filter(a=>a!==null);setAssessments(validAssessments);}}catch(error){console.error('Error loading data:',error);toast.error('Failed to load assessments');}finally{setLoading(false);}};const handleDeleteAssessment=async jobId=>{if(!confirm('Are you sure you want to delete this assessment?'))return;try{const response=await apiCall(\"/api/assessments/\".concat(jobId),{method:'DELETE'});if(response.ok){toast.success('Assessment deleted successfully!');loadData();}else{throw new Error('Failed to delete assessment');}}catch(error){console.error('Error deleting assessment:',error);toast.error('Failed to delete assessment');}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"Loading assessments...\"})]})});}const jobsWithoutAssessments=jobs.filter(job=>!assessments.some(assessment=>assessment.jobId===job.id));return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 dark:bg-gray-900\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center mb-6\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.history.back(),className:\"inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors\",children:[/*#__PURE__*/_jsx(ArrowLeftIcon,{className:\"w-5 h-5 mr-2\"}),\"Go Back\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 dark:text-white mb-2\",children:\"Assessment Management\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:[\"Create and manage job assessments \\u2022 \",assessments.length,\" assessments created\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:async()=>{await reseedDatabase();loadData();toast.success('Database reseeded with sample submissions!');},className:\"mt-4 sm:mt-0 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg transition-colors\",children:\"Reseed Database (Dev)\"})]}),/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-gray-900 dark:text-white mb-4\",children:\"Create New Assessment\"}),jobsWithoutAssessments.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row gap-4\",children:[/*#__PURE__*/_jsxs(\"select\",{className:\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",onChange:e=>{if(e.target.value){onCreateAssessment(e.target.value);e.target.value='';}},defaultValue:\"\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a job to create assessment...\"}),jobsWithoutAssessments.map(job=>/*#__PURE__*/_jsxs(\"option\",{value:job.id,children:[job.title,\" - \",job.location]},job.id))]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{const select=document.querySelector('select');if(select!==null&&select!==void 0&&select.value){onCreateAssessment(select.value);select.value='';}else{toast.error('Please select a job first');}},className:\"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"w-5 h-5 mr-2\"}),\"Create Assessment\"]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(DocumentTextIcon,{className:\"w-12 h-12 text-gray-400 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 dark:text-white mb-2\",children:\"All Jobs Have Assessments\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"Every job posting already has an assessment created.\"})]})]}),/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:0.1},className:\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-6 border-b border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-gray-900 dark:text-white\",children:\"Existing Assessments\"})}),assessments.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"divide-y divide-gray-200 dark:divide-gray-700\",children:assessments.map(assessment=>{var _jobs$find,_assessment$sections,_assessment$sections2;return/*#__PURE__*/_jsx(\"div\",{className:\"p-6 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3 mb-2\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:assessment.title||'Untitled Assessment'}),/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-full\",children:((_jobs$find=jobs.find(j=>j.id===assessment.jobId))===null||_jobs$find===void 0?void 0:_jobs$find.title)||'Unknown Job'})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mb-3\",children:assessment.description||'No description provided'}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-6 text-sm text-gray-500 dark:text-gray-400\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(DocumentTextIcon,{className:\"w-4 h-4 mr-1\"}),((_assessment$sections=assessment.sections)===null||_assessment$sections===void 0?void 0:_assessment$sections.length)||0,\" sections\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(ClockIcon,{className:\"w-4 h-4 mr-1\"}),((_assessment$sections2=assessment.sections)===null||_assessment$sections2===void 0?void 0:_assessment$sections2.reduce((total,section)=>{var _section$questions;return total+(((_section$questions=section.questions)===null||_section$questions===void 0?void 0:_section$questions.length)||0);},0))||0,\" questions\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CheckCircleIcon,{className:\"w-4 h-4 mr-1\"}),\"Created \",new Date(assessment.createdAt).toLocaleDateString()]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setSelectedAssessment(assessment),className:\"inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors\",children:[/*#__PURE__*/_jsx(EyeIcon,{className:\"w-4 h-4 mr-2\"}),\"View Submissions\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onCreateAssessment(assessment.jobId),className:\"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors\",children:[/*#__PURE__*/_jsx(PencilIcon,{className:\"w-4 h-4 mr-1\"}),\"Edit\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleDeleteAssessment(assessment.jobId),className:\"inline-flex items-center px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 transition-colors\",children:[/*#__PURE__*/_jsx(TrashIcon,{className:\"w-4 h-4 mr-1\"}),\"Delete\"]})]})]})},assessment.id);})}):/*#__PURE__*/_jsxs(\"div\",{className:\"p-12 text-center\",children:[/*#__PURE__*/_jsx(DocumentTextIcon,{className:\"w-16 h-16 text-gray-400 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold text-gray-900 dark:text-white mb-2\",children:\"No Assessments Created\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mb-6\",children:\"Get started by creating your first assessment for a job posting.\"}),jobsWithoutAssessments.length>0&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{if(jobsWithoutAssessments[0]){onCreateAssessment(jobsWithoutAssessments[0].id);}},className:\"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"w-5 h-5 mr-2\"}),\"Create First Assessment\"]})]})]}),selectedAssessment&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:0.2},className:\"fixed inset-0 bg-gray-50 dark:bg-gray-900 z-30 overflow-y-auto pt-20\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 dark:text-white mb-2\",children:\"Assessment Submissions\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:[selectedAssessment.title,\" \\u2022 \",((_jobs$find2=jobs.find(j=>j.id===selectedAssessment.jobId))===null||_jobs$find2===void 0?void 0:_jobs$find2.title)||'Unknown Job']})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedAssessment(null),className:\"inline-flex items-center px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors\",children:\"\\u2190 Back to Assessments\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\",children:/*#__PURE__*/_jsx(AssessmentSubmissions,{jobId:selectedAssessment.jobId,jobTitle:((_jobs$find3=jobs.find(j=>j.id===selectedAssessment.jobId))===null||_jobs$find3===void 0?void 0:_jobs$find3.title)||'Unknown Job'})})]})})]})});};export default AssessmentListProfessional;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}