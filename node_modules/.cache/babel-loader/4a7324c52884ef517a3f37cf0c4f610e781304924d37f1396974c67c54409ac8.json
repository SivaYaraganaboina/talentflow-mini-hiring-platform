{"ast":null,"code":"import React,{useState,useEffect}from'react';import{motion}from'framer-motion';import{UserIcon,EnvelopeIcon,CalendarIcon,ChevronRightIcon,CheckCircleIcon,XCircleIcon,EyeIcon}from'@heroicons/react/24/outline';import{apiCall}from'../utils/apiUtils';import{useAuth}from'../store';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const STAGES=[{key:'applied',label:'Applied',color:'blue'},{key:'screen',label:'Screening',color:'yellow'},{key:'tech',label:'Technical',color:'purple'},{key:'offer',label:'Offer',color:'green'},{key:'hired',label:'Hired',color:'emerald'},{key:'rejected',label:'Rejected',color:'red'}];const JobApplications=_ref=>{var _candidates$selectedC,_applications$find;let{jobId}=_ref;const[applications,setApplications]=useState([]);const[candidates,setCandidates]=useState({});const[loading,setLoading]=useState(true);const[selectedCandidate,setSelectedCandidate]=useState(null);const[movingStage,setMovingStage]=useState(null);const{user}=useAuth();useEffect(()=>{loadApplications();},[jobId]);const loadApplications=async()=>{try{setLoading(true);// Load applications for this job\nconst appsResponse=await apiCall(\"/api/applications?jobId=\".concat(jobId));if(appsResponse.ok){var _appsData$data;const appsData=await appsResponse.json();setApplications(appsData.data||[]);// Load candidate details\nconst candidateIds=((_appsData$data=appsData.data)===null||_appsData$data===void 0?void 0:_appsData$data.map(app=>app.candidateId))||[];const candidatesMap={};for(const candidateId of candidateIds){const candidateResponse=await apiCall(\"/api/candidates/\".concat(candidateId));if(candidateResponse.ok){const candidateData=await candidateResponse.json();candidatesMap[candidateId]=candidateData.data;}}setCandidates(candidatesMap);}}catch(error){console.error('Error loading applications:',error);toast.error('Failed to load applications');}finally{setLoading(false);}};const moveToNextStage=async(applicationId,currentStage)=>{const stageIndex=STAGES.findIndex(s=>s.key===currentStage);if(stageIndex===-1||stageIndex>=STAGES.length-2)return;// Can't move from hired/rejected\nconst nextStage=STAGES[stageIndex+1];try{setMovingStage(applicationId);const response=await apiCall(\"/api/applications/\".concat(applicationId,\"/stage\"),{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({stage:nextStage.key,notes:\"Moved to \".concat(nextStage.label,\" stage\"),movedBy:(user===null||user===void 0?void 0:user.name)||'HR Manager'})});if(response.ok){toast.success(\"Candidate moved to \".concat(nextStage.label,\" stage\"));loadApplications();}else{toast.error('Failed to update candidate stage');}}catch(error){toast.error('Failed to update candidate stage');}finally{setMovingStage(null);}};const rejectCandidate=async applicationId=>{try{setMovingStage(applicationId);const response=await apiCall(\"/api/applications/\".concat(applicationId,\"/stage\"),{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({stage:'rejected',notes:'Application rejected',movedBy:(user===null||user===void 0?void 0:user.name)||'HR Manager'})});if(response.ok){toast.success('Candidate rejected');loadApplications();}else{toast.error('Failed to reject candidate');}}catch(error){toast.error('Failed to reject candidate');}finally{setMovingStage(null);}};const formatDate=dateString=>{return new Date(dateString).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});};const getStageColor=stage=>{const stageInfo=STAGES.find(s=>s.key===stage);return(stageInfo===null||stageInfo===void 0?void 0:stageInfo.color)||'gray';};const canMoveToNext=stage=>{return!['hired','rejected'].includes(stage);};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin\"})});}if(applications.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(UserIcon,{className:\"w-12 h-12 text-gray-400 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 dark:text-white mb-2\",children:\"No Applications Yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"Applications will appear here once candidates start applying to this job.\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[STAGES.slice(0,-1).map(stage=>{const stageApplications=applications.filter(app=>app.stage===stage.key);if(stageApplications.length===0)return null;return/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:[stage.label,\" (\",stageApplications.length,\")\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 text-sm font-medium rounded-full bg-\".concat(stage.color,\"-100 text-\").concat(stage.color,\"-800 dark:bg-\").concat(stage.color,\"-900 dark:text-\").concat(stage.color,\"-200\"),children:stage.label})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:stageApplications.map(application=>{const candidate=candidates[application.candidateId];if(!candidate)return null;return/*#__PURE__*/_jsxs(motion.div,{layout:true,className:\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium\",children:candidate.name.charAt(0).toUpperCase()}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900 dark:text-white\",children:candidate.name}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedCandidate(selectedCandidate===candidate.id?null:candidate.id),className:\"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300\",children:/*#__PURE__*/_jsx(EyeIcon,{className:\"w-4 h-4\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400 mt-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(EnvelopeIcon,{className:\"w-4 h-4 mr-1\"}),candidate.email]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"w-4 h-4 mr-1\"}),\"Applied \",formatDate(application.appliedAt)]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[canMoveToNext(application.stage)&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>moveToNextStage(application.id,application.stage),disabled:movingStage===application.id,className:\"inline-flex items-center px-3 py-1 text-sm font-medium text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900 hover:bg-green-200 dark:hover:bg-green-800 rounded-lg transition-colors disabled:opacity-50\",children:[movingStage===application.id?/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 border-2 border-green-600 border-t-transparent rounded-full animate-spin mr-1\"}):/*#__PURE__*/_jsx(ChevronRightIcon,{className:\"w-4 h-4 mr-1\"}),\"Next Stage\"]}),application.stage!=='rejected'&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>rejectCandidate(application.id),disabled:movingStage===application.id,className:\"inline-flex items-center px-3 py-1 text-sm font-medium text-red-700 dark:text-red-300 bg-red-100 dark:bg-red-900 hover:bg-red-200 dark:hover:bg-red-800 rounded-lg transition-colors disabled:opacity-50\",children:[/*#__PURE__*/_jsx(XCircleIcon,{className:\"w-4 h-4 mr-1\"}),\"Reject\"]})]})]},application.id);})})})]},stage.key);}),applications.some(app=>app.stage==='rejected')&&/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:[\"Rejected (\",applications.filter(app=>app.stage==='rejected').length,\")\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:applications.filter(app=>app.stage==='rejected').map(application=>{const candidate=candidates[application.candidateId];if(!candidate)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-4 bg-red-50 dark:bg-red-900/20 rounded-lg opacity-75\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 bg-red-600 rounded-full flex items-center justify-center text-white font-medium\",children:candidate.name.charAt(0).toUpperCase()}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900 dark:text-white\",children:candidate.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"span\",{children:candidate.email}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Applied \",formatDate(application.appliedAt)]})]})]})]}),/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 text-sm font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded-full\",children:\"Rejected\"})]},application.id);})})})]}),selectedCandidate&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\",onClick:()=>setSelectedCandidate(null),children:/*#__PURE__*/_jsx(motion.div,{initial:{scale:0.9,opacity:0},animate:{scale:1,opacity:1},className:\"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto\",onClick:e=>e.stopPropagation(),children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-semibold text-gray-900 dark:text-white\",children:[(_candidates$selectedC=candidates[selectedCandidate])===null||_candidates$selectedC===void 0?void 0:_candidates$selectedC.name,\" - Application Timeline\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedCandidate(null),className:\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\",children:/*#__PURE__*/_jsx(XCircleIcon,{className:\"w-6 h-6\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:(_applications$find=applications.find(app=>app.candidateId===selectedCandidate))===null||_applications$find===void 0?void 0:_applications$find.timeline.map((entry,index)=>{var _STAGES$find;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 rounded-full flex items-center justify-center bg-\".concat(getStageColor(entry.stage),\"-100 text-\").concat(getStageColor(entry.stage),\"-600\"),children:index===0?/*#__PURE__*/_jsx(UserIcon,{className:\"w-4 h-4\"}):/*#__PURE__*/_jsx(CheckCircleIcon,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900 dark:text-white\",children:((_STAGES$find=STAGES.find(s=>s.key===entry.stage))===null||_STAGES$find===void 0?void 0:_STAGES$find.label)||entry.stage}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500 dark:text-gray-400\",children:formatDate(entry.timestamp)})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mt-1\",children:entry.notes}),entry.movedBy&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 dark:text-gray-500 mt-1\",children:[\"by \",entry.movedBy]})]})]},entry.id);})})]})})})]});};export default JobApplications;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}